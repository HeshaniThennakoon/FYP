@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Student Dashboard</title>
    <link rel="stylesheet" href="~/css/student-dashboard.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>
<body>
    <div class="dashboard-container">

        <!-- Sidebar -->
        <aside class="sidebar">
            <h2 class="logo">Students List & Status</h2>
            <ul class="students-list">
                <li><span class="status online"></span> Student 01</li>
                <li><span class="status offline"></span> Student 02</li>
                <li><span class="status online"></span> Student 03</li>
                <li><span class="status online"></span> Student 04</li>
                <li><span class="status offline"></span> Student 05</li>
                <li><span class="status online"></span> Student 06</li>
                <li><span class="status offline"></span> Student 07</li>
                <li><span class="status online"></span> Student 08</li>
                <li><span class="status offline"></span> Student 09</li>
                <li><span class="status offline"></span> Student 10h</li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content">

            <!-- Top Navigation -->
            <div class="topbar">
                <div class="icons">
                    <i class="fa fa-bell"></i>
                    <i class="fa fa-user-circle"></i>
                </div>
            </div>

            <!-- Content Section -->
            <div class="content">

                <!-- Video/Sharing Section -->
                <div class="video-section">
                    <div class="video-box"></div>
                    <div class="controls">
                        <i class="fa fa-camera"></i>
                        <i class="fa fa-microphone"></i>
                        <button class="btn-share" id="startSharingBtn">
                            <i class="fas fa-share-square"></i> Start Sharing
                        </button>

                        <button class="btn-share stop" id="stopSharingBtn" disabled>
                            <i class="fas fa-stop-circle"></i> Stop Sharing
                        </button>

                        <script>
                            const startBtn = document.getElementById('startSharingBtn');
                            const stopBtn = document.getElementById('stopSharingBtn');

                            // ---------------------------
                            // START SHARING
                            // ---------------------------
                            startBtn.addEventListener('click', async function () {
                                const token = localStorage.getItem('token') || localStorage.getItem('jwt') || localStorage.getItem('access_token');

                                if (!token) {
                                    alert('You are not logged in! JWT token not found.');
                                    return;
                                }

                                try {
                                    const studentName = localStorage.getItem("name");

                                    console.log('Starting sharing for:', studentName);

                                    const response = await fetch('http://localhost:3000/api/model/start', {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json',
                                            'Authorization': `Bearer ${token}`
                                        },
                                        body: JSON.stringify({ student_name: studentName })
                                    });

                                    if (response.ok) {
                                        const data = await response.json();
                                        alert('Screen sharing started successfully!');
                                        console.log('Success:', data);

                                        // Update buttons
                                        startBtn.disabled = true;
                                        startBtn.innerHTML = '<i class="fas fa-check"></i> Sharing...';

                                        stopBtn.disabled = false;

                                    } else {
                                        const errorText = await response.text();
                                        alert('Failed to start sharing: ' + response.status + ' ' + errorText);
                                    }

                                } catch (err) {
                                    console.error('Error:', err);
                                    alert('Error: ' + err.message);
                                }
                            });

                            // ---------------------------
                            // STOP SHARING
                            // ---------------------------
                            stopBtn.addEventListener('click', async function () {
                                const token = localStorage.getItem('token') || localStorage.getItem('jwt') || localStorage.getItem('access_token');

                                if (!token) {
                                    alert('You are not logged in! JWT token not found.');
                                    return;
                                }

                                try {
                                    const studentName = localStorage.getItem("name");

                                    console.log('Stopping sharing for:', studentName);

                                    const response = await fetch('http://localhost:3000/api/model/stop', {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json',
                                            'Authorization': `Bearer ${token}`
                                        },
                                        body: JSON.stringify({ student_name: studentName })
                                    });

                                    if (response.ok) {
                                        const data = await response.json();
                                        alert('Screen sharing stopped successfully!');
                                        console.log('Success:', data);

                                        // Update buttons
                                        stopBtn.disabled = true;
                                        stopBtn.innerHTML = '<i class="fas fa-stop-circle"></i> Stopped';

                                        startBtn.disabled = false;
                                        startBtn.innerHTML = '<i class="fas fa-share-square"></i> Start Sharing';

                                    } else {
                                        const errorText = await response.text();
                                        alert('Failed to stop sharing: ' + response.status + ' ' + errorText);
                                    }

                                } catch (err) {
                                    console.error('Error:', err);
                                    alert('Error: ' + err.message);
                                }
                            });
                        </script>

                    </div>
                </div>

                <!-- Chat Section -->
                <div class="chat-box">
                    <h3>Chat with Teacher</h3>
                    <div class="messages">
                        <div class="msg teacher">Hello Student!</div>
                        <div class="msg student">Hello Teacher!</div>
                    </div>
                    <div class="chat-input">
                        <input type="text" placeholder="Type a message..." />
                        <button><i class="fa fa-paper-plane"></i></button>
                    </div>
                </div>

            </div>

        </main>
    </div>
</body>
</html>
